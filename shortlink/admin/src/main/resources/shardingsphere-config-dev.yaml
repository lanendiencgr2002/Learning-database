# 数据源配置
dataSources:
  ds_0:  # 主数据源名称
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource  # 使用Hikari连接池提升性能
    driverClassName: com.mysql.cj.jdbc.Driver               # MySQL 8.0驱动
    # 数据库连接URL，包含以下特性：
    # - useUnicode=true：支持Unicode字符集
    # - characterEncoding=UTF-8：使用UTF-8编码
    # - rewriteBatchedStatements=true：启用批量操作优化
    # - allowMultiQueries=true：允许多条SQL语句
    # - serverTimezone：设置时区为上海
    jdbcUrl: jdbc:mysql://127.0.0.1:3306/link?useUnicode=true&characterEncoding=UTF-8&rewriteBatchedStatements=true&allowMultiQueries=true&serverTimezone=Asia/Shanghai
    username: root      # 数据库用户名
    password: root      # 数据库密码
 
# 分片规则配置
rules:
  # 分片配置，使用SHARDING策略
  - !SHARDING
    tables:
      # 用户表分片配置
      t_user:
        actualDataNodes: ds_0.t_user_${0..15}  # 实际节点分布：16个分片表
        tableStrategy:
          standard:  # 标准分片策略
            shardingColumn: username   # 分片键：用户名
            shardingAlgorithmName: user_table_hash_mod  # 使用哈希取模算法
      
      # 分组表分片配置
      t_group:
        actualDataNodes: ds_0.t_group_${0..15}  # 实际节点分布：16个分片表
        tableStrategy:
          standard:  # 标准分片策略
            shardingColumn: username   # 分片键：用户名
            shardingAlgorithmName: group_table_hash_mod  # 使用哈希取模算法
    
    # 分片算法定义
    shardingAlgorithms:
      user_table_hash_mod:   # 用户表分片算法
        type: HASH_MOD       # 哈希取模算法
        props:
          sharding-count: 16  # 分片数量
      group_table_hash_mod:  # 分组表分片算法
        type: HASH_MOD       # 哈希取模算法
        props:
          sharding-count: 16  # 分片数量

  # 加密规则配置
  - !ENCRYPT
    tables:
      t_user:  # 用户表加密配置
        columns:
          phone:  # 手机号加密
            cipherColumn: phone        # 密文列名
            encryptorName: common_encryptor  # 使用通用加密器
          mail:   # 邮箱加密
            cipherColumn: mail         # 密文列名
            encryptorName: common_encryptor  # 使用通用加密器
        queryWithCipherColumn: true    # 查询时使用密文列
    
    # 加密器配置
    encryptors:
      common_encryptor:    # 通用加密器
        type: AES          # AES加密算法
        props:
          aes-key-value: d6oadClrrb9A3GWo  # AES密钥

# 属性配置
props:
  sql-show: true  # 开启SQL显示，用于调试